image: fedora:32

before_script:
- export INGESTUM_WORKER=multiprocessed
- dnf -y install https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-32.noarch.rpm
- dnf -y install wget pip gcc python-devel python3-virtualenv libSM libXrender libXext poppler-utils sox attr ffmpeg ghostscript tesseract libXScrnSaver gtk3 libreoffice-writer libreoffice-calc libreoffice-graphicfilter
- mkdir ~/.deepspeech
- wget -O ~/.deepspeech/models.pbmm https://github.com/mozilla/DeepSpeech/releases/download/v0.7.3/deepspeech-0.7.3-models.pbmm
- wget -O ~/.deepspeech/models.scorer https://github.com/mozilla/DeepSpeech/releases/download/v0.7.3/deepspeech-0.7.3-models.scorer
- pip install --user .

tests:
  stage: test
  script:
  - ./qa.sh
  - pip install -r docs/requirements.txt
  - sphinx-build -b html docs public
  only:
  - branches
  except:
  - master

pages:
  stage: deploy
  script:
  - pip install -r docs/requirements.txt
  - sphinx-build -b html docs public
  artifacts:
    paths:
    - public
  only:
  - master
